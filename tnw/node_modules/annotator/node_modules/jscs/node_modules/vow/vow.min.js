/**
 * @module vow
 * @author Filatov Dmitry <dfilatov@yandex-team.ru>
 * @version 0.4.10
 * @license
 * Dual licensed under the MIT and GPL licenses:
 *   * http://www.opensource.org/licenses/mit-license.php
 *   * http://www.gnu.org/licenses/gpl.html
 */(function(e){var t,n=function(){var t=[],n=function(e){return t.push(e)===1},r=function(){var e=t,n=0,r=t.length;t=[];while(n<r)e[n++]()};if(typeof setImmediate=="function")return function(e){n(e)&&setImmediate(r)};if(typeof process=="object"&&process.nextTick)return function(e){n(e)&&process.nextTick(r)};var i=e.MutationObserver||e.WebKitMutationObserver;if(i){var s=1,o=document.createTextNode("");return(new i(r)).observe(o,{characterData:!0}),function(e){n(e)&&(o.data=s*=-1)}}if(e.postMessage){var u=!0;if(e.attachEvent){var a=function(){u=!1};e.attachEvent("onmessage",a),e.postMessage("__checkAsync","*"),e.detachEvent("onmessage",a)}if(u){var f="__promise"+ +(new Date),l=function(e){e.data===f&&(e.stopPropagation&&e.stopPropagation(),r())};return e.addEventListener?e.addEventListener("message",l,!0):e.attachEvent("onmessage",l),function(t){n(t)&&e.postMessage(f,"*")}}}var c=e.document;if("onreadystatechange"in c.createElement("script")){var h=function(){var e=c.createElement("script");e.onreadystatechange=function(){e.parentNode.removeChild(e),e=e.onreadystatechange=null,r()},(c.documentElement||c.body).appendChild(e)};return function(e){n(e)&&h()}}return function(e){n(e)&&setTimeout(r,0)}}(),r=function(e){n(function(){throw e})},i=function(e){return typeof e=="function"},s=function(e){return e!==null&&typeof e=="object"},o=Object.prototype.toString,u=Array.isArray||function(e){return o.call(e)==="[object Array]"},a=function(e){var t=[],n=0,r=e.length;while(n<r)t.push(n++);return t},f=Object.keys||function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},l=function(e){var t=function(t){this.name=e,this.message=t};return t.prototype=new Error,t},c=function(e,t){return function(n){e.call(this,n,t)}},h=function(){this._promise=new d};h.prototype={promise:function(){return this._promise},resolve:function(e){this._promise.isResolved()||this._promise._resolve(e)},reject:function(e){if(this._promise.isResolved())return;g.isPromise(e)?(e=e.then(function(e){var t=g.defer();return t.reject(e),t.promise()}),this._promise._resolve(e)):this._promise._reject(e)},notify:function(e){this._promise.isResolved()||this._promise._notify(e)}};var p={PENDING:0,RESOLVED:1,FULFILLED:2,REJECTED:3},d=function(e){this._value=t,this._status=p.PENDING,this._fulfilledCallbacks=[],this._rejectedCallbacks=[],this._progressCallbacks=[];if(e){var n=this,r=e.length;e(function(e){n.isResolved()||n._resolve(e)},r>1?function(e){n.isResolved()||n._reject(e)}:t,r>2?function(e){n.isResolved()||n._notify(e)}:t)}};d.prototype={valueOf:function(){return this._value},isResolved:function(){return this._status!==p.PENDING},isFulfilled:function(){return this._status===p.FULFILLED},isRejected:function(){return this._status===p.REJECTED},then:function(e,t,n,r){var i=new h;return this._addCallbacks(i,e,t,n,r),i.promise()},"catch":function(e,n){return this.then(t,e,n)},fail:function(e,n){return this.then(t,e,n)},always:function(e,t){var n=this,r=function(){return e.call(this,n)};return this.then(r,r,t)},progress:function(e,n){return this.then(t,t,e,n)},spread:function(e,t,n){return this.then(function(t){return e.apply(this,t)},t,n)},done:function(e,t,n,i){this.then(e,t,n,i).fail(r)},delay:function(e){var t,n=this.then(function(n){var r=new h;return t=setTimeout(function(){r.resolve(n)},e),r.promise(